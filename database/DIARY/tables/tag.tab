CREATE TABLE tag (
   tag_id     NUMBER
    GENERATED BY DEFAULT AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER NOCYCLE NOKEEP NOSCALE NOT NULL ENABLE
  ,name       VARCHAR2(50) NOT NULL ENABLE
  ,color_hex  VARCHAR2(7)
  ,created_on TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE
  ,created_by VARCHAR2(128) DEFAULT COALESCE(
     SYS_CONTEXT('APEX$SESSION','APP_USER')
   ,SYS_CONTEXT('USERENV','SESSION_USER')
  ) NOT NULL ENABLE
  ,updated_on TIMESTAMP(6)
  ,updated_by VARCHAR2(128)
  ,PRIMARY KEY ( tag_id )
    USING INDEX ENABLE
  ,CONSTRAINT uk_tag_name UNIQUE ( name )
    USING INDEX ENABLE
);

--INDEXES

CREATE UNIQUE INDEX sys_c0013602 ON tag (tag_id);

CREATE UNIQUE INDEX uk_tag_name ON tag (name);

--REFERENTIAL CONSTRAINTS

--COMMENTS

COMMENT ON TABLE tag  IS 'Reusable labels for entries.';

--TRIGGERS

CREATE OR REPLACE TRIGGER tag_biur
BEFORE INSERT OR UPDATE ON TAG
FOR EACH ROW
BEGIN
  IF INSERTING THEN
    IF :NEW.CREATED_ON IS NULL THEN
      :NEW.CREATED_ON := SYSTIMESTAMP;
    END IF;
    IF :NEW.CREATED_BY IS NULL THEN
      :NEW.CREATED_BY := COALESCE(
        SYS_CONTEXT('APEX$SESSION','APP_USER'),
        SYS_CONTEXT('USERENV','SESSION_USER')
      );
    END IF;
  END IF;

  IF UPDATING THEN
    :NEW.UPDATED_ON := SYSTIMESTAMP;
    :NEW.UPDATED_BY := COALESCE(
      SYS_CONTEXT('APEX$SESSION','APP_USER'),
      SYS_CONTEXT('USERENV','SESSION_USER')
    );
  END IF;
END;
/
ALTER TRIGGER tag_biur ENABLE;

--GRANTS

--SYNONYMS
